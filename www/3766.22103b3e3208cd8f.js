"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3766],{3766:(k,_,d)=>{d.r(_),d.d(_,{BarcodeScanningPage:()=>U});var s=d(5861),p=d(95),E=d(2726),Z=function(o){return o.Aztec="AZTEC",o.Codabar="CODABAR",o.Code39="CODE_39",o.Code93="CODE_93",o.Code128="CODE_128",o.DataMatrix="DATA_MATRIX",o.Ean8="EAN_8",o.Ean13="EAN_13",o.Itf="ITF",o.Pdf417="PDF_417",o.QrCode="QR_CODE",o.UpcA="UPC_A",o.UpcE="UPC_E",o}(Z||{}),b=function(o){return o.Front="FRONT",o.Back="BACK",o}(b||{});const a=(0,E.fo)("BarcodeScanner",{web:()=>d.e(7338).then(d.bind(d,7338)).then(o=>new o.BarcodeScannerWeb)});var i=d(6728),S=d(6814),e=d(5678);let A=(()=>{var o;class m{constructor(n,t,r,u){this.alertCtrl=n,this.modalCtrl=t,this.loadingCtrl=r,this.popoverCtrl=u}dismissModal(n){var t=this;return(0,s.Z)(function*(){return t.modalCtrl.dismiss(n)})()}showAlert(n){var t=this;return(0,s.Z)(function*(){const r=yield t.alertCtrl.create(n);return yield r.present(),r})()}showErrorAlert(n){var t=this;return(0,s.Z)(function*(){return n={header:"Error",buttons:["OK"],...n},t.showAlert(n)})()}showModal(n){var t=this;return(0,s.Z)(function*(){const r=yield t.modalCtrl.create(n);return yield r.present(),r})()}showPopover(n){var t=this;return(0,s.Z)(function*(){const r=yield t.popoverCtrl.create(n);return yield r.present(),r})()}showLoading(n){var t=this;return(0,s.Z)(function*(){n={message:"Please wait...",...n};const u=yield t.loadingCtrl.create(n);return yield u.present(),u})()}}return(o=m).\u0275fac=function(n){return new(n||o)(e.LFG(i.Br),e.LFG(i.IN),e.LFG(i.HT),e.LFG(i.Dh))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),m})();const N=["square"];function M(o,m){if(1&o){const f=e.EpF();e.TgZ(0,"ion-fab",6)(1,"ion-fab-button",1),e.NdJ("click",function(){e.CHM(f);const t=e.oxw();return e.KtG(t.toggleTorch())}),e._UZ(2,"ion-icon",7),e.qZA()()}}let w=(()=>{var o;class m{constructor(n,t){this.dialogService=n,this.ngZone=t,this.formats=[],this.lensFacing=b.Back,this.isTorchAvailable=!1}ngOnInit(){a.isTorchAvailable().then(n=>{this.isTorchAvailable=n.available})}ngAfterViewInit(){setTimeout(()=>{this.startScan()},250)}ngOnDestroy(){this.stopScan()}closeModal(n){var t=this;return(0,s.Z)(function*(){console.log("closeModal: Cerrando modal con c\xf3digo",n),t.dialogService.dismissModal({barcode:n})})()}toggleTorch(){return(0,s.Z)(function*(){console.log("toggleTorch: Alternando linterna"),yield a.toggleTorch()})()}startScan(){var n=this;return(0,s.Z)(function*(){var t,r;console.log("startScan: Mostrando modal"),null===(t=document.querySelector("body"))||void 0===t||t.classList.add("barcode-scanning-active");const u={formats:n.formats,lensFacing:n.lensFacing},c=null===(r=n.squareElement)||void 0===r?void 0:r.nativeElement.getBoundingClientRect(),l=c?{left:c.left*window.devicePixelRatio,right:c.right*window.devicePixelRatio,top:c.top*window.devicePixelRatio,bottom:c.bottom*window.devicePixelRatio,width:c.width*window.devicePixelRatio,height:c.height*window.devicePixelRatio}:void 0,g=l?[[l.left,l.top],[l.left+l.width,l.top],[l.left+l.width,l.top+l.height],[l.left,l.top+l.height]]:void 0,v=yield a.addListener("barcodeScanned",function(){var C=(0,s.Z)(function*(P){n.ngZone.run(()=>{const h=P.barcode.cornerPoints;g&&h&&(g[0][0]>h[0][0]||g[0][1]>h[0][1]||g[1][0]<h[1][0]||g[1][1]>h[1][1]||g[2][0]<h[2][0]||g[2][1]<h[2][1]||g[3][0]>h[3][0]||g[3][1]<h[3][1])||(v.remove(),n.closeModal(P.barcode))})});return function(P){return C.apply(this,arguments)}}());yield a.startScan(u)})()}stopScan(){return(0,s.Z)(function*(){var n;null===(n=document.querySelector("body"))||void 0===n||n.classList.remove("barcode-scanning-active"),yield a.stopScan(),console.log("stopScan: Deteniendo escaneo")})()}}return(o=m).\u0275fac=function(n){return new(n||o)(e.Y36(A),e.Y36(e.R0b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-barcode-scanning"]],viewQuery:function(n,t){if(1&n&&e.Gf(N,5),2&n){let r;e.iGM(r=e.CRH())&&(t.squareElement=r.first)}},inputs:{formats:"formats",lensFacing:"lensFacing"},standalone:!0,features:[e.jDz],decls:11,vars:1,consts:[["slot","end"],[3,"click"],["name","close"],[1,"square"],["square",""],["slot","fixed","horizontal","end","vertical","bottom",4,"ngIf"],["slot","fixed","horizontal","end","vertical","bottom"],["name","flashlight"]],template:function(n,t){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3,"Escaner QR"),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return t.closeModal()}),e._UZ(6,"ion-icon",2),e.qZA()()()(),e.TgZ(7,"ion-content"),e._UZ(8,"div",3,4),e.YNc(10,M,3,0,"ion-fab",5),e.qZA()),2&n&&(e.xp6(10),e.Q6J("ngIf",t.isTorchAvailable))},dependencies:[i.Pc,i.YG,i.Sm,i.W2,i.IJ,i.W4,i.Gu,i.gu,i.wd,i.sr,S.ez,S.O5],styles:["ion-content[_ngcontent-%COMP%]{--background: transparent}.square[_ngcontent-%COMP%]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:16px;width:200px;height:200px;border:6px solid white;box-shadow:0 0 0 4000px #0000004d}"]}),m})();var D=d(7021),T=d(3331),I=d(2333),L=d(3612);let U=(()=>{var o;class m{constructor(n,t,r,u,c,l,g,v,C,P,h){this.router=n,this.fb=t,this.attServ=r,this.alertController=u,this.menuCtrl=c,this.authServ=l,this.dialogService=g,this.ngZone=v,this.loadingController=C,this.perfServ=P,this.cdr=h,this.barcodeFormat=Z,this.lensFacing=b,this.formGroup=new p.nJ({formats:new p.p4([]),lensFacing:new p.p4(b.Back),googleBarcodeScannerModuleInstallState:new p.p4(0),googleBarcodeScannerModuleInstallProgress:new p.p4(0)}),this.scannedBarcode=null,this.isSupported=!1,this.isPermissionGranted=!1,this.asistencias=[],this.horarios=[],this.environmentInjector=(0,e.f3M)(e.lqb)}ngOnInit(){var n=this;return(0,s.Z)(function*(){console.log("ngOnInit: Iniciando BarcodeScanningPage");try{const r=yield a.isSupported();n.isSupported=r.supported,console.log("Soporte de esc\xe1ner:",r.supported),n.isSupported||n.showNotSupportedAlert()}catch(r){console.error("Error al verificar el soporte del esc\xe1ner",r)}const t=yield a.checkPermissions();console.log("Estado de los permisos:",t.camera),"granted"!==t.camera&&(yield a.requestPermissions()),a.isSupported().then(r=>{n.isSupported=r.supported}),a.checkPermissions().then(r=>{n.isPermissionGranted="granted"===r.camera}),a.removeAllListeners().then(()=>{a.addListener("googleBarcodeScannerModuleInstallProgress",r=>{console.log("Evento barcodeScanned:",r),n.ngZone.run(()=>{console.log("googleBarcodeScannerModuleInstallProgress",r);const{state:u,progress:c}=r;n.formGroup.patchValue({googleBarcodeScannerModuleInstallState:u,googleBarcodeScannerModuleInstallProgress:c})})})});try{yield n.installGoogleBarcodeScannerModuleIfNeeded()}catch(r){console.error("Error al instalar el m\xf3dulo del esc\xe1ner de Google",r)}})()}installGoogleBarcodeScannerModuleIfNeeded(){return(0,s.Z)(function*(){const n=yield a.isGoogleBarcodeScannerModuleAvailable();console.log("M\xf3dulo del esc\xe1ner de Google instalado:",n),n||(yield a.installGoogleBarcodeScannerModule(),console.log("M\xf3dulo del esc\xe1ner de Google instalado correctamente"))})()}startScan(){var n=this;return(0,s.Z)(function*(){var t,r;console.log("startScan: Iniciando escaneo");const u=(null===(t=n.formGroup.get("formats"))||void 0===t?void 0:t.value)||[],c=(null===(r=n.formGroup.get("lensFacing"))||void 0===r?void 0:r.value)||b.Back;(yield n.dialogService.showModal({component:w,cssClass:"barcode-scanning-modal",showBackdrop:!1,componentProps:{formats:u,lensFacing:c}})).onDidDismiss().then(g=>{var v;const C=null===(v=g.data)||void 0===v?void 0:v.barcode;C&&(n.scannedBarcode=C||null)})})()}scan(){var n=this;return(0,s.Z)(function*(){try{var t;const r=(null===(t=n.formGroup.get("formats"))||void 0===t?void 0:t.value)||[],{barcodes:u}=yield a.scan({formats:r});n.scannedBarcode=u[0]||null;try{if(null==n.scannedBarcode)return void alert("Error al registrar asistencia");n.attServ.guardarAsistencia(n.scannedBarcode.displayValue),alert("Asistencia registrada con \xe9xito"),n.navegarYCargarAsistencias()}catch(c){console.log(c),alert("Error al registrar asistencia")}}catch(r){r.message.includes("Google Barcode Scanner Module is not available")?yield n.installGoogleBarcodeScannerModule():console.error("Error durante el escaneo",r)}})()}openSettings(){return(0,s.Z)(function*(){yield a.openSettings()})()}requestPermissions(){return(0,s.Z)(function*(){yield a.requestPermissions()})()}onSubmit(){}goBack(){this.router.navigate(["/home"])}presentAlert(){var n=this;return(0,s.Z)(function*(){yield(yield n.alertController.create({header:"Permission denied",message:"Please grant camera permission to use the barcode scanner.",buttons:["OK"]})).present()})()}openMenu(){this.menuCtrl.open("second")}onLogout(){this.authServ.logout().subscribe(()=>{})}showNotSupportedAlert(){var n=this;return(0,s.Z)(function*(){yield(yield n.alertController.create({header:"Scanner Not Supported",message:"The barcode scanner is not supported on this device.",buttons:["OK"]})).present()})()}installGoogleBarcodeScannerModule(){var n=this;return(0,s.Z)(function*(){const t=yield n.loadingController.create({message:"Instalando m\xf3dulo del esc\xe1ner..."});yield t.present();try{yield a.installGoogleBarcodeScannerModule(),console.log("M\xf3dulo del esc\xe1ner de Google instalado correctamente")}catch(r){console.error("Error al instalar el m\xf3dulo del esc\xe1ner de Google",r)}finally{yield t.dismiss()}})()}navegarYCargarAsistencias(){var n=this;return(0,s.Z)(function*(){yield n.router.navigate(["/home"]),window.location.reload()})()}showLoading(n="Cargando..."){var t=this;return(0,s.Z)(function*(){yield(yield t.loadingController.create({message:n,spinner:"crescent"})).present()})()}hideLoading(){var n=this;return(0,s.Z)(function*(){yield n.loadingController.dismiss()})()}}return(o=m).\u0275fac=function(n){return new(n||o)(e.Y36(D.F0),e.Y36(p.qu),e.Y36(T.v),e.Y36(i.Br),e.Y36(i._q),e.Y36(I.e),e.Y36(A),e.Y36(e.R0b),e.Y36(i.HT),e.Y36(L.F),e.Y36(e.sBO))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-barcode-scanning"]],standalone:!0,features:[e.jDz],decls:33,vars:1,consts:[["side","end","menuId","second","contentId","scan-content"],[3,"click"],["aria-hidden","true","name","power","slot","start"],["id","scan-content"],[1,"wrapper"],[1,""],["src","../../../../assets/img/logo/logo-dark.svg","alt","QR Placeholder"],[1,"button-form",3,"disabled","click"],["slot","bottom",1,"duocFooter"],["name","arrow-back-outline"],["name","menu-outline"]],template:function(n,t){1&n&&(e.TgZ(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),e._uU(4,"Men\xfa"),e.qZA()()(),e.TgZ(5,"ion-content")(6,"ion-list")(7,"ion-item",1),e.NdJ("click",function(){return t.onLogout()}),e._UZ(8,"ion-icon",2),e.TgZ(9,"ion-label"),e._uU(10,"Cerrar Sesi\xf3n"),e.qZA()()()()(),e.TgZ(11,"ion-header")(12,"ion-toolbar")(13,"ion-title"),e._uU(14,"Escanear C\xf3digo QR"),e.qZA()()(),e.TgZ(15,"ion-content",3)(16,"ion-row",4)(17,"div",5),e._UZ(18,"img",6),e.qZA(),e.TgZ(19,"div")(20,"ion-button",7),e.NdJ("click",function(){return t.scan()}),e._uU(21,"Start Scan"),e.qZA()()()(),e.TgZ(22,"ion-footer")(23,"ion-toolbar")(24,"ion-tabs")(25,"ion-tab-bar",8)(26,"ion-tab-button",1),e.NdJ("click",function(){return t.goBack()}),e._UZ(27,"ion-icon",9),e._uU(28," Regresar "),e.qZA(),e.TgZ(29,"ion-tab-button",1),e.NdJ("click",function(){return t.openMenu()}),e._UZ(30,"ion-icon",10),e.TgZ(31,"ion-label"),e._uU(32,"M\xe1s"),e.qZA()()()()()()),2&n&&(e.xp6(20),e.Q6J("disabled",!t.isSupported))},dependencies:[i.Pc,i.YG,i.W2,i.fr,i.Gu,i.gu,i.Ie,i.Q$,i.q_,i.z0,i.Nd,i.yq,i.ZU,i.wd,i.sr,i.UN,S.ez,p.u5,p.UX],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%}.button-form[_ngcontent-%COMP%]{width:100%;--background: #ffc107}ion-menu[_ngcontent-%COMP%]{--width: 65%}.flex-container[_ngcontent-%COMP%]{flex:1;display:flex;justify-content:center;align-items:center}.flex-container[_ngcontent-%COMP%]   .qr-button[_ngcontent-%COMP%]{width:18rem;background-color:#0c243c;color:#fff}@media (prefers-color-scheme: dark){ion-toolbar[_ngcontent-%COMP%], .duocFooter[_ngcontent-%COMP%]{--background: #0c263f;--color: #fff}ion-content[_ngcontent-%COMP%]{--ion-background-color: #001426}ion-menu[_ngcontent-%COMP%] > ion-content[_ngcontent-%COMP%] > ion-list[_ngcontent-%COMP%]{--ion-item-background: #0c263f;--color: #fff}}"]}),m})()}}]);